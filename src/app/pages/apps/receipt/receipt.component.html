<div class="hk-pg-wrapper" id="qqq">
  <div *ngIf="!show">

    <!-- Receipts Cards -->
    <div class="row">
      <div class="col-lg-4">
        <div class="card">
          <div class="card-body">
            <div class="d-flex flex-wrap align-items-center">
              <div class="mr-auto">
                <p class="text-uppercase text-dark font-weight-bold mb-1">
                  Total Sales
                </p>
              </div>
              <p class="text-blue font-weight-bold font-size-24 mb-0">
                ₹ {{totalsales}}
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="card">
          <div class="card-body">
            <div class="d-flex flex-wrap align-items-center">
              <div class="mr-auto">
                <p class="text-uppercase text-dark font-weight-bold mb-1">
                  Tolal Payment
                </p>

              </div>
              <p class="text-success font-weight-bold font-size-24 mb-0">
                ₹ {{totalpayments}}
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="card">
          <div class="card-body">
            <div class="d-flex flex-wrap align-items-center">
              <div class="mr-auto">
                <p class="text-uppercase text-dark font-weight-bold mb-1">
                  Refunds
                </p>
              </div>
              <p class="text-danger font-weight-bold font-size-24 mb-0">
                ₹ {{totalrefund}}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Receipt Search Bar -->

    <div class="row">
      <div class="col-xl-4">
        <div>
          <input type="text" class="form-control" placeholder="Search Receipt.." [(ngModel)]="term"
            (input)="onKeySearch()">

          <div class="form-group hidden">
            <div class="input-group">
              <input name="datepicker" class="form-control hidden" ngbDatepicker #datepicker="ngbDatepicker"
                [autoClose]="'outside'" (dateSelect)="onDateSelection($event, datepicker)" [displayMonths]="2"
                [dayTemplate]="t" outsideDays="hidden" [startDate]="fromDate!" tabindex="-1">
              <ng-template #t let-date let-focused="focused">
                <span class="custom-day" [class.focused]="focused" [class.range]="isRange(date)"
                  [class.faded]="isHovered(date) || isInside(date)" (mouseenter)="hoveredDate = date"
                  (mouseleave)="hoveredDate = null">
                  {{ date.day }}
                </span>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xl-4">
        <h6 class="pl-3">Showing receipts from {{strdate| date: 'MMM d, y'}} to
          {{enddate| date: 'MMM d, y'}}</h6>
      </div>
      <div class="col-xl-4">

        <nz-range-picker style="width: inherit;" [(ngModel)]="dateRange" (ngModelChange)="onChange($event)">
        </nz-range-picker>
      </div>
      <br><br>
    </div>


    <div class="col-xl-12 pl-0 pr-0">
      <!-- <section class="hk-sec-wrapper">
              <div class="row">
                  <div class="col-sm"> -->
      <div class="table-wrap" *ngIf="receipts!=undefinde">
        <div class="table-responsive" *ngIf="(receipts.receipts).length>0;else emptyreceipt">
          <table class="table mb-0 text-center">{{ngforLen}}
            <thead>
              <tr>
                <th>OrderNo</th>
                <th>Created At</th>
                <th>Customer Details</th>
                <th>Order Status</th>
                <th>Payment Status</th>
                <th>Paid</th>
                <!-- <th></th> -->
                <th>BillAmount</th>
                <!-- <th></th> -->
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of receipts.receipts ;let i=index">
                <td class="text-left"><img src="{{item.logo}}" width="20"><button type="button" class="btn btn-link"
                    (click)=" show = 1 ; filter(item.id,item.chargeAmount,item.paidAmount); OrderStatus = item.orderStatusId">{{item.invoiceNo}}</button>
                </td>
                <td>{{item.orderedDateTime}}</td>
                <td class="text-center">
                  {{item.customer==null?"-":item.customer}}/{{item.phoneNo==null?"-":item.phoneNo}}
                </td>
                <td><span *ngIf="item.orderStatusId == 5">Completed</span>
                  <span *ngIf="item.orderStatusId != -1 && item.orderStatusId != 5">Pending</span>
                  <span *ngIf="item.orderStatusId == -1">Cancelled</span>
                </td>
                <td>
                  <span *ngIf="item.orderStatusId != -1 && item.billAmount == item.paidAmount"
                    class="badge badge-success mr-10">Paid</span>
                  <span *ngIf="item.orderStatusId != -1 && item.billAmount > item.paidAmount"
                    class="badge badge-warning mr-10">Pending</span>
                  <span *ngIf="item.orderStatusId == -1" class="badge badge-danger mr-10">Cancelled</span>
                  <span *ngIf="item.orderStatusId != -1 && item.billAmount < item.paidAmount"
                    class="badge badge-danger mr-10">Refundable</span>
                </td>
                <td>&#8377;{{item.paidAmount}} /-</td>
                <!-- <td>
                                              <i class="fe fe-balance-scale-right"></i>
                                          </td> -->
                <td>{{item.orderStatusId==-1?'Refunded &#8377;'+item.billAmount+'
                  /-':'&#8377;'+item.billAmount+' /-' }}
                </td>
              </tr>
            </tbody>
          </table>
          <div class="text-center">
            <button [class.disabled]="LastId" [ngClass]="{'text-blue': !LastId}" class="btn btn-link"
              (click)="nextRecipts('prev')">Previous</button>
            <button [class.disabled]="FirstId" [ngClass]="{'text-blue': !FirstId}" class="btn btn-link text-blue"
              (click)="nextRecipts('next')">Next</button>
          </div>
        </div>
        <ng-template #emptyreceipt>
          <p class="text-center">No receipts found!</p>
        </ng-template>
      </div>
      <!-- </div>
              </div>
          </section> -->
    </div>
    <!-- </div> -->
  </div>

  <div class="container" *ngIf="show">
    <!-- Title -->
    <div class="hk-pg-header col-xl-12 row">
      <h4 class="hk-pg-title col-xl-6"> <span class="badge badge-primary mr-2">{{ordertypes}}</span> {{orderno}}
      </h4>
      <div class="mb-10 text-right col-xl-6 float-right"><button class="btn btn-link"
          (click)="show=0">Back</button>|<button class="btn btn-link" (click)="electronPrint()">print</button>
        <span *ngIf="OrderStatus != -1&&roleid == 1"> |<button class="btn btn-link"
            (click)="openOrderpopup(CancelReceipt)">Cancel</button></span>
      </div>
    </div>
    <!-- Row -->
    <div class="col-xl-12 pl-0 pr-0">
      <section class="hk-sec-wrapper">
        <div class="row col-xl-12">
          <div class="col-xl-6 mt-5">
            <div class="mb-2 ml-0 row">
              <strong>CustomerName :</strong><span> {{customer.name }} | {{customer.phoneNo }}</span>
            </div>
            <div class="mb-2 ml-0 row">
              <strong>CustomerAddress :</strong><span>{{customer.address}}</span>
            </div>
            <!-- <hr> -->
            <div class="mb-2 ml-0 row">
              <strong>Order Tickets: </strong>
              <span *ngFor="let item of KOTs; let last = last" (click)="KOTFilter(item.id);openOrderpopup(KOTItem)"><a
                  href="javascript:void(0)" class="sp-fit-width">&nbsp;#{{item.KOTNo}}<span
                    *ngIf="!last">,</span>&nbsp;</a></span>
            </div>
            <!-- <hr> -->
            <div class="mb-2">
              <strong>Payment History</strong><br>
              <ul>
                <span *ngFor="let item of transactions">
                  <li *ngIf="item.transTypeId==1">
                    <span class="text-success">₹ {{item.amount}}
                      /-</span> on {{item.transDateTime}} by <span class="badge badge-success">{{item.name}}</span>
                  </li>
                  <li *ngIf="item.transTypeId==2">
                    <span class="text-danger">₹
                      {{item.amount}}</span> /- Refunded on {{item.transDateTime}} by <span
                      class="badge badge-success">{{item.name}}</span>
                  </li>
                </span>
              </ul>
              <!-- <span *ngIf="item.TransTypeId==1"> </span>
                              <span *ngIf="item.TransTypeId==2"></span>
                              <br> -->
            </div>
            <!-- <hr> -->
            <div class="row" *ngIf="OrderStatus != -1&&Total-PaidAmount>0">
              <div class="col-md-12 pt-0">
                <strong class="sp-margin-left20">Pending Payment
                  :</strong><span>{{Total-PaidAmount}}</span>
              </div>
            </div>

          </div>
          <div class="col-xl-6">
            <div class="table-wrap">
              <div class="table-responsive">
                <table class="table mb-0">
                  <thead>
                    <tr>
                      <th><strong>Item</strong></th>
                      <th><strong>Qty</strong></th>
                      <th><strong>Tax%</strong></th>
                      <th class="text-right"><strong>Price</strong></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr [ngClass]="{print: last}" *ngFor="let item of orderitem;let last = last"
                      style="border-bottom: 1px solid #000;">
                      <td>{{item.description}}</td>
                      <td>{{item.orderQuantity}}{{item.complementryQty>0?'+'+item.complementryQty:''}}
                      </td>
                      <td>{{item.tax1 + item.tax2 + item.tax3}}</td>
                      <td class="text-right">{{((item.orderQuantity > 0) ? item.totalAmount : 0) |
                        number: ".2" }}</td>
                      <!-- <hr> -->
                    </tr>
                    <tr>
                      <td class="cs" [attr.colspan]="3"><strong>Subtotal</strong><br><br>
                        <span
                          *ngFor="let item of AdditionalCharges"><strong>{{item.description}}</strong><br><br></span>
                        <span *ngIf="Discount > 0"><strong>Discount</strong><br><br></span>
                        <strong *ngIf="CGST">CGST</strong><br><br>
                        <strong *ngIf="SGST">SGST</strong><br><br>
                        <strong>Total</strong><br><br>
                      </td>
                      <td class="text-right">{{Subtotal | number: ".2" }}<br><br>
                        <span class="text-right" *ngFor="let item of AdditionalCharges">{{item.ChargeAmount | number:
                          ".2" }}<br><br></span>
                        <span class="text-right" *ngIf="Discount > 0">{{Discount | number: ".2"
                          }}<br><br></span>
                        <span class="text-right" *ngIf="CGST">{{CGST | number: ".2" }}
                        </span><br><br>
                        <span class="text-right" *ngIf="SGST">{{SGST | number: ".2" }}
                        </span><br><br>
                        <span class="text-right">{{Total | number: ".2" }} </span><br><br>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <hr>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

<ng-template #splitpayment let-modal aria-label="modal-basic-title">
  <div class="modal d-block position-static overflow-show" tabindex="-1" role="dialog">
    <div class="modal-dialog ma-0" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">SplitPayment</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="modal.close()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div>Rs.{{remaining}}/-<span class="d-block valid-feedback" *ngIf="remaining >= 0">Remaining</span><span
              class="d-block invalid-feedback" *ngIf="remaining < 0">Exceded</span></div>
          <div class="row">
            <div class="col-sm">
              <form>
                <div *ngFor="let item of receipts.PaymentType">
                  <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-4 col-form-label">{{item.Description}}</label>
                    <div class="col-sm-8">
                      <div class="input-group mb-3">
                        <input (input)="sum()" [(ngModel)]="item.Price" name="{{item.Description}}" type="number"
                          class="form-control">
                      </div>
                    </div>
                  </div>
                </div>
                <!-- {{receipts.PaymentType | json}} -->
                <!-- <div  class="form-group row">
                                          <label for="inputEmail3" class="col-sm-4 col-form-label">Card</label>
                                          <div class="col-sm-8">
                                              <div class="input-group mb-3">                                            
                                                  <input [(ngModel)] ="item.Price" name="Card" type="number" class="form-control" aria-label="Amount (to the nearest dollar)">
                                                </div>
                                          </div>
                                        </div>-->
              </form>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary float-right" [disabled]="remaining < 0"
            (click)="modal.close();transaction.PaymentTypeId = 5;setPrice()">Save</button>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #KOTItem let-modal aria-label="modal-basic-title">
  <div class="modal d-block position-static overflow-show" tabindex="-1" role="dialog">
    <div class="modal-dialog ma-0" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Order Ticket</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="modal.close()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <!-- <div class="col-xs-12">
                                      <label class="sp-full-width">
                                          <span class="glyphicon glyphicon-time icon-grey">MainKitchen</span>
                                          <span class="pull-right sp-pad-right-10">{{customer.Name}} | {{customer.PhoneNo}}</span>
                                      </label>
                                  </div> -->
            <div class="col-xs-12 col-sm-6" *ngIf="KOTItems.AddedItems.length > 0">
              <label><span class="badge badge-primary badge-indicator"></span> Added Items</label>
              <div *ngFor="let item of KOTItems.AddedItems" class="sp - margin-bottom5">
                <span>{{item.Quantity}} x {{item.Description}}</span>
              </div>
            </div>
            <div class="col-xs-12 col-sm-6" *ngIf="KOTItems.RemovedItems.length > 0">
              <label><span class="badge badge-danger badge-indicator"></span> Removed Items</label>
              <div *ngFor="let item of KOTItems.RemovedItems" class="sp - margin-bottom5">
                <span>{{item.Quantity}} x {{item.Description}}</span>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary float-right" (click)="modal.close()">Ok(Esc)</button>
        </div>
      </div>
    </div>
  </div>
  <!-- </div>   -->
</ng-template>
<ng-template #CancelReceipt let-modal aria-label="modal-basic-title">
  <div class="modal d-block position-static overflow-show" tabindex="-1" role="dialog">
    <div class="modal-dialog ma-0" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Refund!</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="modal.close()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body text-center pl-100">
          <div class="row">
            <span>
              <span class="sp-margin-top20">
                <span class="sp-option-detail sp-no-user-select" (click)="transaction.PaymentTypeId = 1">
                  <span *ngIf="transaction.PaymentTypeId == 1"
                    class="glyphicon glyphicon-ok sp-option-selected"></span>Cash</span></span>
              <span class="sp-margin-top20">
                <span class="sp-option-detail sp-no-user-select" (click)="transaction.PaymentTypeId = 2">
                  <span *ngIf="transaction.PaymentTypeId == 2"
                    class="glyphicon glyphicon-ok sp-option-selected"></span>Card/Credit</span></span>
              <span class="sp-margin-top20">
                <span class="sp-option-detail sp-no-user-select" (click)="transaction.PaymentTypeId = 3">
                  <span *ngIf="transaction.PaymentTypeId == 3"
                    class="glyphicon glyphicon-ok sp-option-selected"></span>Others</span></span>
            </span>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary float-right"
            (click)="cancel(PaidAmount);modal.close()">Ok(Esc)</button>
        </div>
      </div>
    </div>
  </div>
  <!-- </div>   -->
</ng-template>